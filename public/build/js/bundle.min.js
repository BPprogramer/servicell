!function(){if(document.querySelector("#informacionCompleta")){const e=document.querySelector("#ingresos"),t=document.querySelector("#gastos"),o=document.querySelector("#ganancias"),n=document.querySelector("#ganancias_mes_actual"),a=document.querySelector("#ganancias_3_meses"),c=document.querySelector("#pendientes"),r=document.querySelector("#reparados"),i=document.querySelector("#cerrados");!async function(){try{const s=await fetch("/api/dashboard"),l=await s.json();console.log(l),function(s){e.textContent="$"+parseFloat(s.ingresos_totales).toLocaleString("en"),t.textContent="$"+parseFloat(s.gastos_totales).toLocaleString("en"),o.textContent="$"+parseFloat(s.ganancias).toLocaleString("en"),n.textContent="$"+parseFloat(s.ganancias_mes_actual).toLocaleString("en"),a.textContent="$"+parseFloat(s.ganancias_3_meses).toLocaleString("en"),c.textContent=s.pendientes,r.textContent=s.reparados,i.textContent=s.cerrados}(l)}catch(e){}}()}}(),function(){const e=document.querySelector("#btnEstadoReparacion");if(e){const a=document.querySelector("#btnTotalReparacion"),c=document.querySelector("#btnImprimirReparacion");async function t(){const r=o(),i=`${location.origin}/api/reparacion/estado-actual?id=${r}`;try{const o=await fetch(i),r=await o.json();!function(o){0==o.estado&&(e.classList.add("bg-secondary"),e.textContent="Pendiente");1==o.estado&&(e.classList.remove("bg-secondary"),e.classList.add("bg-success"),e.textContent="Reparado");2==o.estado&&(e.classList.remove("bg-success"),e.classList.add("bg-danger"),e.textContent="Cerrado");e.dataset.estado=o.estado,2!=o.estado&&e.addEventListener("click",(function(){!function(e){let o="";0==e.estado&&(o='<h2 class="">Acepta estar seguro de dar por  <span class="font-weight-bold"> REPARADO </span> el dispositvo?</h2><br><p>Esta acción no se puede deshacer</p> ');1==e.estado&&(o='<h2 class="">Acepta estar seguro de dar por  <span class="font-weight-bold"> FINALIZADA </span> esta reparación?</h2><br><p>Esta acción no se puede deshacer</p>');Swal.fire({icon:"warning",html:o,showCancelButton:!0,confirmButtonText:"Seguro",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&async function(e){const o=parseInt(e.estado)+1,a=new FormData;a.append("estado",o),a.append("reparacion_id",e.id),a.append("cliente_id",e.cliente_id);try{const e=await fetch("/api/reparacion/cambiar-estado",{body:a,method:"POST"}),o=await e.json();n(),"error"==o.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:o.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:o.msg}),setTimeout(()=>{n()},8e3),t())}catch(e){}}(e)})}(o)}))}(r),function(e){if(0==e.estado)a.innerHTML="Total: <strong></strong>";else{const t=parseFloat(e.valor_final)-parseFloat(e.abono)+parseFloat(e.costo_final);a.innerHTML=`Total: <strong>$${parseFloat(t).toLocaleString("en")}</strong>`}}(r),function(e){0!=e.estado&&c.addEventListener("click",(function(){!async function(e){const t="/api/factura-finalizada?key="+btoa(e);try{await fetch(t);window.open(t,"_blank")}catch(e){}}(e.id)}))}(r)}catch(e){}}function o(){const e=window.location.href,t=new URL(e);return id=t.searchParams.get("id")}function n(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}t()}}(),function(){if(document.querySelector("#navReparacion")){const e=document.querySelector("#general"),t=document.querySelector("#notificaciones"),o=document.querySelector("#avanzado"),n=document.querySelector("#info_general"),a=document.querySelector("#info_notificaciones"),c=document.querySelector("#info_avanzado");e.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),e.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),a.classList.add("d-none"),c.classList.add("d-none")}),t.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),t.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),n.classList.add("d-none"),c.classList.add("d-none")}),o.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),o.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),a.classList.add("d-none"),n.classList.add("d-none")})}}(),function(){if(document.querySelector("#tabla-notificaciones")){const c=document.querySelector("#btnSubmitNotificacion"),r=document.querySelector("#agregar-notificacion"),i=document.querySelector("#notificacionForm"),s=document.querySelector("#mensaje"),l=document.querySelector("#imagenes"),d=document.querySelector("#contenedorImganes");async function e(){const e=o(),n=`${location.origin}/api/reparacion/notificaciones?id=${e}`;try{const e=await fetch(n);!function(e){const o=document.querySelector("#tabla-notificaciones");t(o);const n=document.createElement("tbody");let a=0;e.forEach(e=>{a++;const{id:t,mensaje:o,imagenes:c}=e,r=document.createElement("tr"),i=document.createElement("TD"),s=document.createElement("DIV");s.classList.add("row","d-flex","justify-content-between");const l=document.createElement("P");l.classList.add("col-md-8"),l.innerHTML="<strong>Mensaje:</strong><br>"+o;const d=document.createElement("DIV");d.id="carousel_"+a,d.classList.add("carousel","slide","float-right"),d.dataset.ride="carousel",d.style.maxWidth="350px",d.style.padding="10px";const u=document.createElement("OL");u.classList.add("carousel-indicators");const m=document.createElement("DIV");m.classList.add("carousel-inner");let p=1;c.forEach(e=>{if(""!=e){const t=document.createElement("LI");t.dataset.target="#carousel_"+a,t.dataset.slideTo=""+p;const o=document.createElement("DIV");o.classList.add("carousel-item");const n=document.createElement("IMG");n.classList.add("d-block","w-100"),n.src=`/img/notificaciones/${e}.png`,1==p&&(t.classList.add("active"),o.classList.add("active")),u.appendChild(t),o.appendChild(n),m.appendChild(o),p++}});const g=document.createElement("A");g.classList.add("carousel-control-prev"),g.href="#carousel_"+a,g.setAttribute("role","button"),g.dataset.slide="prev",g.innerHTML='\n                          <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                          <span class="sr-only">Previous</span>\n              ';const f=document.createElement("A");f.classList.add("carousel-control-next"),f.href="#carousel_"+a,f.setAttribute("role","button"),f.dataset.slide="next",f.innerHTML=' \n                          <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                          <span class="sr-only">Next</span>\n              ',d.appendChild(u),d.appendChild(m),d.appendChild(g),d.appendChild(f),s.appendChild(l),s.appendChild(d),i.appendChild(s),r.appendChild(i),n.appendChild(r)}),o.appendChild(n)}(await e.json())}catch(e){}}function t(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function o(){const e=window.location.href,t=new URL(e);return id=t.searchParams.get("id")}function n(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function a(){$.validator.setDefaults({submitHandler:function(){!async function(){const t=new FormData;t.append("mensaje",s.value.trim()),t.append("reparacion_id",o());const a=l.files;if(a.length>0)for(let e=0;e<a.length;e++)t.append("imagenes[]",a[e]);else t.append("imagenes[]",[]);c.disabled=!0,url="/api/reparacion/crear-notificacion";try{const o=await fetch(url,{body:t,method:"POST"}),a=await o.json();n(),c.disabled=!1,"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),setTimeout(()=>{n()},4e3),i.reset(),$("#modal-notificacion").modal("hide"),e())}catch(e){}}()}}),$("#notificacionForm").validate({rules:{mensaje:{required:!0}},messages:{mensaje:{required:"El mensaje de la notifiación es Obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}r.addEventListener("click",(function(e){i.reset(),t(d),$("#modal-notificacion").modal("show"),a()})),e(),l.addEventListener("change",(function(e){t(d);const o=e.target.files;for(let e=0;e<o.length;e++){const t=o[e],n=new FileReader;n.onload=function(e){const t=document.createElement("img");t.src=e.target.result,t.classList.add("col-md-4","mb-3"),d.appendChild(t)},n.readAsDataURL(t)}})),$("#notificacionForm").on("valid",(function(e){a()}))}}(),function(){if(document.querySelector("#tabla-ingresos")){let c;const r=document.querySelector("#agregar-ingreso"),i=document.querySelector("#ingresoForm"),s=document.querySelector("#ingreso"),l=document.querySelector("#descripcion_ingreso"),d=document.querySelector("#btnSubmitIngreso"),u=document.querySelector("#totalIngresos");async function e(){const n=t(),c=`${location.origin}/api/reparacion/ingresos?id=${n}`;try{const t=await fetch(c);!function(t){const n=document.querySelector("#tabla-ingresos");!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(n);const c=document.createElement("tbody"),r=t.reduce((function(e,t){return e+parseFloat(t.ingreso)}),0);u.textContent=r.toLocaleString("en"),t.forEach(t=>{const{id:n,ingreso:r,descripcion:i,reparacion_id:s}=t,l=document.createElement("tr"),d=document.createElement("td");d.classList.add("py-2"),d.style.minWidth="130px",d.innerHTML=`Valor: $<strong>${parseFloat(r).toLocaleString("en")}</strong>`;const u=document.createElement("td");u.classList.add("py-2"),u.innerHTML=`Descripcion: <strong style="max-width:30px !important">${i}</strong>`;const m=document.createElement("td");m.classList.add("py-2"),m.style.minWidth="120px";const p=document.createElement("BUTTON");p.type="button",p.classList.add("btn","btn-sm","bg-hover-azul","mx-2","text-white","toolMio"),p.innerHTML="<span class='toolMio-text'>Editar</span><i class='fas fa-pen'></i>",p.onclick=function(){o(t)};const g=document.createElement("BUTTON");g.type="button",g.classList.add("btn","btn-sm","bg-hover-azul","mx-2","text-white","toolMio"),g.innerHTML="<span class='toolMio-text'>Eliminar</span><i class='fas fa-trash'></i>",g.type="button",g.onclick=function(){var o;o=t,Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el Ingreso de <span class="font-weight-bold"> ${parseFloat(o.ingreso).toLocaleString("en")} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(t){const o=new FormData;o.append("id",t);try{const t=await fetch("/api/reparacion/eliminar-ingreso",{body:o,method:"POST"}),n=await t.json();"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{a()},8e3),e())}catch(e){}}(o.id)})},m.appendChild(p),m.appendChild(g),l.appendChild(d),l.appendChild(u),l.appendChild(m),c.appendChild(l)}),n.appendChild(c)}(await t.json())}catch(e){}}function t(){const e=window.location.href,t=new URL(e);return id=t.searchParams.get("id")}function o(e){c=e.id,$("#modal-ingreso").modal("show"),n(),s.value=parseFloat(e.ingreso).toLocaleString("en"),l.value=e.descripcion}function n(){$.validator.setDefaults({submitHandler:function(){!async function(){const o=new FormData;o.append("ingreso",s.value),o.append("descripcion",l.value.trim()),d.disabled=!0;let n="";c?(c&&o.append("id",c),n="/api/reparacion/editar-ingreso"):(n="/api/reparacion/crear-ingreso",o.append("reparacion_id",t()));try{const t=await fetch(n,{body:o,method:"POST"}),c=await t.json();a(),d.disabled=!1,"error"==c.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:c.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:c.msg}),setTimeout(()=>{a()},4e3),i.reset(),$("#modal-ingreso").modal("hide"),e())}catch(e){}}()}}),$("#ingresoForm").validate({rules:{ingreso:{required:!0}},messages:{ingreso:{required:"El valor del Ingreso es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function a(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}r.addEventListener("click",(function(e){i.reset(),c=null,$("#modal-ingreso").modal("show"),n()})),s.addEventListener("input",(function(e){const t=function(e){const t=e.target.value;let o=parseFloat(t.replace(/,/g,""));isNaN(o)&&(o="");return o.toLocaleString("en")}(e);s.value=t})),e(),$("#ingresoForm").on("valid",(function(e){n()}))}}(),function(){if(document.querySelector("#reparacion")){let c;const r=document.querySelector("#agregar-costo"),i=document.querySelector("#costoForm"),s=document.querySelector("#costo"),l=document.querySelector("#descripcion"),d=document.querySelector("#btnSubmitCosto"),u=document.querySelector("#totalCostos");async function e(){const n=t(),c=`${location.origin}/api/reparacion/costos?id=${n}`;try{const t=await fetch(c);!function(t){const n=document.querySelector("#tabla-costos");!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(n);const c=document.createElement("tbody"),r=t.reduce((function(e,t){return e+parseFloat(t.costo)}),0);u.textContent=r.toLocaleString("en"),t.forEach(t=>{const{id:n,costo:r,descripcion:i,reparacion_id:s}=t,l=document.createElement("tr"),d=document.createElement("td");d.classList.add("py-2"),d.style.minWidth="130px",d.innerHTML=`Valor: $<strong>${parseFloat(r).toLocaleString("en")}</strong>`;const u=document.createElement("td");u.classList.add("py-2"),u.innerHTML=`Descripcion: <strong style="max-width:30px !important">${i}</strong>`;const m=document.createElement("td");m.classList.add("py-2"),m.style.minWidth="120px";const p=document.createElement("BUTTON");p.type="button",p.classList.add("btn","btn-sm","bg-hover-azul","mx-2","text-white","toolMio"),p.innerHTML="<span class='toolMio-text'>Editar</span><i class='fas fa-pen'></i>",p.onclick=function(){o(t)};const g=document.createElement("BUTTON");g.type="button",g.classList.add("btn","btn-sm","bg-hover-azul","mx-2","text-white","toolMio"),g.innerHTML="<span class='toolMio-text'>Eliminar</span><i class='fas fa-trash'></i>",g.type="button",g.onclick=function(){var o;o=t,Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar el costo de <span class="font-weight-bold"> ${parseFloat(o.costo).toLocaleString("en")} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(t){const o=new FormData;o.append("id",t);try{const t=await fetch("/api/reparacion/eliminar-costo",{body:o,method:"POST"}),n=await t.json();console.log(n),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{a()},8e3),e(),console.log("recargano"))}catch(e){console.log(e)}}(o.id)})},m.appendChild(p),m.appendChild(g),l.appendChild(d),l.appendChild(u),l.appendChild(m),c.appendChild(l)}),n.appendChild(c)}(await t.json())}catch(e){}}function t(){const e=window.location.href,t=new URL(e);return id=t.searchParams.get("id")}function o(e){c=e.id,$("#modal-costo").modal("show"),n(),s.value=parseFloat(e.costo).toLocaleString("en"),l.value=e.descripcion}function n(){$.validator.setDefaults({submitHandler:function(){!async function(){const o=new FormData;o.append("costo",s.value),o.append("descripcion",l.value.trim()),d.disabled=!0;let n="";c?(c&&o.append("id",c),n="/api/reparacion/editar-costo"):(n="/api/reparacion/crear-costo",o.append("reparacion_id",t()));try{const t=await fetch(n,{body:o,method:"POST"}),c=await t.json();a(),d.disabled=!1,"error"==c.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:c.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:c.msg}),setTimeout(()=>{a()},4e3),i.reset(),$("#modal-costo").modal("hide"),e())}catch(e){}}()}}),$("#costoForm").validate({rules:{costo:{required:!0}},messages:{costo:{required:"El valor del costo es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}r.addEventListener("click",(function(e){i.reset(),c=null,$("#modal-costo").modal("show"),n()})),s.addEventListener("input",(function(e){const t=function(e){const t=e.target.value;let o=parseFloat(t.replace(/,/g,""));isNaN(o)&&(o="");return o.toLocaleString("en")}(e);s.value=t})),e(),$("#costoForm").on("valid",(function(e){n()}))}function a(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}}(),function(){if(document.querySelector("#reparaciones")){let r;const i=["NO ESPECIFICA","SAMSUMG","MOTOROLA","NOKIA","LG","XIAOMI","KRONO","LENOVO","ALCATEL","HIUNDAI","IPHONE","SENDTEL","ASUS","TOSHIBA","DELL","HP","OPPO","REALME","HONOR","POCO","VIVO","ACER","SONY","BLU","CATERPILLAR","HTC","INFINIX","MICROSOFT","PANASONIC","SHARP","SONY ERICSSON","TLC","ZTE","OTRAS"],s=document.querySelector("#reparacionForm");let l=null;const d=document.querySelector("#nombre"),u=document.querySelector("#direccion"),m=document.querySelector("#marca"),p=document.querySelector("#cedula_nit"),g=document.querySelector("#celular"),f=document.querySelector("#modelo"),h=document.querySelector("#imei_1"),y=document.querySelector("#imei_2"),b=document.querySelector("#falla"),v=document.querySelector("#proceso"),S=document.querySelector("#valor_convenido"),C=document.querySelector("#abono"),E=document.querySelector("#saldo"),L=document.querySelector("#cargador"),q=document.querySelector("#bateria"),T=document.querySelector("#tapa"),w=document.querySelector("#estuche"),x=document.querySelector("#sim"),O=document.querySelector("#sd"),F=document.querySelector("#observacion"),I=document.querySelector("#registrar");function e(e){const t=e.target.value;let o=parseFloat(t.replace(/,/g,""));isNaN(o)&&(o="");return o.toLocaleString("en")}function t(){s.reset(),btnSubmit.disabled=!1,$("#modal-reparacion").modal("show"),a(),l&&async function(){try{const e=await fetch("/api/reparacion?id="+l);!function(e){const t=JSON.parse(e.accesorios);d.value=e.nombre,p.value=e.cedula_nit,g.value=e.celular,u.value=e.direccion,c(e.marca),f.value=e.modelo,h.value=e.imei_1,y.value=e.imei_2,b.value=e.falla,v.value=e.proceso,S.value=parseFloat(e.valor_convenido).toLocaleString("en"),C.value=parseFloat(e.abono).toLocaleString("en"),E.value=parseFloat(e.saldo).toLocaleString("en"),0!=e.estado&&(C.readOnly=!0,S.readOnly=!0);1==t.cargador&&(L.checked=!0);1==t.bateria&&(q.checked=!0);1==t.estuche&&(w.checked=!0);1==t.tapa&&(T.checked=!0);1==t.sim&&(x.checked=!0);1==t.sd&&(O.checked=!0);F.value=e.observacion}(await e.json())}catch(e){console.log(e)}}()}async function o(){const e=new FormData;l&&e.append("id",l),e.append("nombre",d.value.trim()),e.append("cedula_nit",p.value.trim()),e.append("celular",g.value),e.append("direccion",u.value.trim()),e.append("marca",m.value),e.append("modelo",f.value.trim()),e.append("imei_1",h.value.trim()),e.append("imei_2",y.value.trim()),e.append("falla",b.value.trim()),e.append("proceso",v.value.trim()),e.append("valor_convenido",S.value),e.append("abono",C.value),e.append("saldo",E.value),e.append("observacion",F.value.trim()),e.append("accesorios",function(){checkOBJ.cargador=L.checked,checkOBJ.tapa=T.checked,checkOBJ.bateria=q.checked,checkOBJ.estuche=w.checked,checkOBJ.sim=x.checked,checkOBJ.sd=O.checked;return JSON.stringify(checkOBJ).replace(/\\/g,"")}()),btnSubmit.disabled=!0;let t="";l?t="/api/reparacion/editar":(console.log("creando"),t="/api/reparacion/crear");try{const o=await fetch(t,{body:e,method:"POST"}),a=await o.json();n(),btnSubmit.disabled=!1,"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):(r.ajax.reload(),$(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:a.msg}),setTimeout(()=>{n()},4e3),s.reset(),$("#modal-reparacion").modal("hide"))}catch(e){}}function n(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function a(){$.validator.setDefaults({submitHandler:function(){o()}}),$("#reparacionForm").validate({rules:{nombre:{required:!0},cedula_nit:{required:!0},celular:{required:!0,digits:!0,minlength:10,maxlength:10},valor_convenido:{required:!0}},messages:{nombre:{required:"El nombre de la categoría es obligatorio"},cedula_nit:{required:"El Número de identificación es obligatorio"},celular:{required:"El Celular de contacto es obligatorio",digits:"El número de celular solo puede contener números",minlength:"El número de celular debe de ser de 10 digitos",maxlength:"El número de celular debe de ser de 10 digitos"},valor_convenido:{required:"El valor convenido es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}function c(e){for(;m.firstChild;)m.removeChild(m.firstChild);i.forEach(t=>{const o=document.createElement("OPTION");o.value=t,o.textContent=t,t==e&&(o.selected=!0),m.appendChild(o)})}checkOBJ={cargador:!1,bateria:!1,tapa:!1,estuche:!1,SIM:!1,SD:!1},$("#tabla").dataTable().fnDestroy(),r=$("#tabla").DataTable({ajax:"/api/reparaciones",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(r,{buttons:["copy","csv","excel","pdf","print"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),I.addEventListener("click",(function(){C.readOnly=!1,S.readOnly=!1,l=null,c("NO ESPECIFICA"),t()})),$("#reparaciones").on("click","#editar",(function(e){C.readOnly=!1,S.readOnly=!1,l=e.currentTarget.dataset.reparacionId,t()})),$("#reparaciones").on("click","#eliminar",(function(e){!function(e,t){const o=t.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de Cancelar la reparación del cliente <span class="font-weight-bold"> ${o} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(e){const t=new FormData;t.append("id",e);try{const e=await fetch("/api/reparacion/eliminar",{body:t,method:"POST"}),o=await e.json();n(),"error"==o.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:o.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:o.msg}),setTimeout(()=>{n()},8e3),r.ajax.reload())}catch(e){$(document).Toasts("create",{class:"bg-danger",title:"Error",body:"No es Posible eliminar La reparacion porque tiene gastos y/o ingrseso asociados"}),setTimeout(()=>{n()},8e3)}}(e)})}(e.currentTarget.dataset.reparacionId,e)})),$("#reparaciones").on("click","#imprimir",(function(e){!async function(e){const t="/api/factura?key="+btoa(e);try{await fetch(t);window.open(t,"_blank")}catch(e){}}(e.currentTarget.dataset.reparacionId)})),S.addEventListener("input",(function(t){S.value=e(t),E.value=e(t),C.value=0})),C.addEventListener("input",(function(t){!function(e){const t=S.value,o=parseFloat(t.replace(/,/g,""));let n=parseFloat(e.target.value.replace(/,/g,""));""==n&&(n=0);const a=o-n;console.log(o),isNaN(a)&&(a="");const c=a.toLocaleString("en");E.value=c}(t),C.value=e(t)})),$("#reparacionForm").on("valid",(function(e){a()})),$(".select2").select2(),$(".select2bs4").select2({theme:"bootstrap4"})}}(),function(){if(document.querySelector("#loginForm")){const o=document.querySelector("#email"),n=document.querySelector("#password"),a=document.querySelector("#btnSubmit");async function e(){a.disabled=!0;const e=new FormData;e.append("email",o.value.trim()),e.append("password",n.value);try{const t="/usuario/login",o=await fetch(t,{body:e,method:"POST"}),n=await o.json();document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove(),"error"==n.type?(a.disabled=!1,$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg})):(1==n.roll&&(window.location.href="/inicio"),2==n.roll&&(window.location.href="/clientes"))}catch(e){}}function t(){console.log("asdf"),$.validator.setDefaults({submitHandler:function(){e()}}),$("#loginForm").validate({rules:{email:{required:!0},password:{required:!0}},messages:{email:{required:"El usuario es obligatorio"},password:{required:"El password es obligatorio"}},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}t(),$("#loginForm").on("valid",(function(e){t()}))}}(),function(){if(document.querySelector("#usuarios")){let c,r=null;const i=document.querySelector("#registrar"),s=document.querySelector("#usuarioForm"),l=document.querySelector("#btnSubmit"),d=document.querySelector("#nombre"),u=document.querySelector("#email"),m=document.querySelector("#estado"),p=document.querySelector("#roll"),g=document.querySelector("#password");function e(){document.querySelectorAll("#editar").forEach(e=>{e.addEventListener("click",(function(e){r=e.currentTarget.dataset.usuarioId,t()}))});document.querySelectorAll("#eliminar").forEach(e=>{e.addEventListener("click",(function(e){!function(e,t){const n=t.currentTarget.parentElement.parentElement.parentElement.childNodes[1].textContent;Swal.fire({icon:"warning",html:`<h2 class="">esta seguro de eliminar al usuario <span class="font-weight-bold"> ${n} </span>?</h2><br><p>Esta acción no se puede deshacer</p>`,showCancelButton:!0,confirmButtonText:"Eliminar",cancelButtonText:"Cancelar"}).then(t=>{t.isConfirmed&&async function(e){const t=new FormData;t.append("id",e),url=location.origin+"/usuario/eliminar";try{const e=await fetch(url,{body:t,method:"POST"}),n=await e.json();o(),"error"==n.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:n.msg}):($(document).Toasts("create",{class:"bg-azul text-blanco",title:"Completado",body:n.msg}),setTimeout(()=>{o()},8e3),c.ajax.reload())}catch(e){console.log(e)}}(e)})}(e.currentTarget.dataset.usuarioId,e)}))})}function t(){$("#usuarioForm").validate().destroy(),s.reset(),l.disabled=!1,n(m),n(p);const e=document.createElement("OPTION");e.setAttribute("disabled","disabled"),e.setAttribute("selected","selected"),e.textContent="--Seleccione--";const t=document.createElement("OPTION");t.value=0,t.textContent="Inactivo";const o=document.createElement("OPTION");o.value=1,o.textContent="Activo";const c=document.createElement("OPTION");c.setAttribute("disabled","disabled"),c.setAttribute("selected","selected"),c.textContent="--Seleccione--";const i=document.createElement("OPTION");i.value=0,i.textContent="Vendedor";const g=document.createElement("OPTION");g.value=1,g.textContent="Administrador";const f=document.createElement("OPTION");f.value=2,f.textContent="Cliente",m.appendChild(e),m.appendChild(t),m.appendChild(o),p.appendChild(c),p.appendChild(i),p.appendChild(g),p.appendChild(f),$("#modal-usuario").modal("show"),a(),r&&async function(){try{const e=await fetch("/api/usuario?id="+r);!function(e){d.value=e.nombre,u.value=e.email;m.querySelector('option[value="'+e.estado+'"]').setAttribute("selected","selected");p.querySelector('option[value="'+e.roll+'"]').setAttribute("selected","selected")}(await e.json())}catch(e){console.log(e)}}()}function o(){document.querySelector("#toastsContainerTopRight")&&document.querySelector("#toastsContainerTopRight").remove()}function n(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function a(){$.validator.setDefaults({submitHandler:function(){!async function(){const e=new FormData;r&&e.append("id",r),e.append("nombre",d.value.trim()),e.append("email",u.value),e.append("estado",m.value),e.append("roll",p.value),e.append("password",g.value),l.disabled=!0;let t="";t=r?location.origin+"/usuario/editar":location.origin+"/usuario/crear";try{const n=await fetch(t,{body:e,method:"POST"}),a=await n.json();console.log(a),l.disabled=!1,o(),l.disabled=!1,"error"==a.type?$(document).Toasts("create",{class:"bg-danger",title:"Error",body:a.msg}):($(document).Toasts("create",{class:"bg-primary",title:"Completado",body:a.msg}),setTimeout(()=>{o()},4e3),s.reset(),$("#modal-usuario").modal("hide"),c.ajax.reload())}catch(e){}}()}});let e={},t={};r||(e={required:!0,minlength:6},t={required:"El password es obligatorio",minlength:"El Password debe tener al menos 6 caracteres"}),$("#usuarioForm").validate({rules:{nombre:{required:!0},email:{required:!0},estado:{required:!0},roll:{required:!0},password:e,terms:{required:!0}},messages:{nombre:{required:"El nombre es obligatorio"},email:{required:"El email es obligatorio"},estado:{required:"el estado es obligatorio"},roll:{required:"el Roll es obligatorio"},password:t},errorElement:"span",errorPlacement:function(e,t){e.addClass("invalid-feedback"),t.closest(".form-group").append(e)},highlight:function(e,t,o){$(e).addClass("is-invalid")},unhighlight:function(e,t,o){$(e).removeClass("is-invalid")}})}i.addEventListener("click",(function(){r=null,t()})),$("#tabla").dataTable().fnDestroy(),c=$("#tabla").DataTable({ajax:"/api/usuarios",deferRender:!0,retrieve:!0,proccesing:!0,responsive:!0,initComplete:function(){new $.fn.dataTable.Buttons(c,{buttons:["copy","csv","excel","pdf","print","colvis"]}).container().appendTo("#tabla_wrapper .col-md-6:eq(0)")}}),c.on("draw",e),$("#usuarioForm").on("valid",(function(e){a()}))}}(),function(){if(document.querySelector("#navReparacionCliente")){const e=document.querySelector("#btnEstadoReparacion"),t=document.querySelector("#btnTotalReparacion"),o=document.querySelector("#btnImprimirReparacion");!async function(){const n=document.querySelector("#idReparacion").dataset.reparacionId,a=`${location.origin}/api/reparacion/estado-actual?id=${n}`;try{const n=await fetch(a),c=await n.json();!function(t){0==t.estado&&(e.classList.add("bg-secondary"),e.textContent="Pendiente");1==t.estado&&(e.classList.remove("bg-secondary"),e.classList.add("bg-success"),e.textContent="Reparado");2==t.estado&&(e.classList.remove("bg-success"),e.classList.add("bg-danger"),e.textContent="Cerrado");e.dataset.estado=t.estado,2!=t.estado&&e.addEventListener("click",(function(){alertaCambiarEstado(t)}))}(c),function(e){if(0==e.estado)t.innerHTML="Total: <strong></strong>";else{const o=parseFloat(e.valor_final)-parseFloat(e.abono)+parseFloat(e.costo_final);t.innerHTML=`Total: <strong>$${parseFloat(o).toLocaleString("en")}</strong>`}}(c),function(e){0!=e.estado&&o.addEventListener("click",(function(e){console.log("imprimiendo")}))}(c)}catch(e){}}()}}(),function(){if(document.querySelector("#tabla-costos-cliente")){const e=document.querySelector("#totalIngresos");!async function(){const t=document.querySelector("#idReparacion").dataset.reparacionId,o=`${location.origin}/api/reparacion/ingresos?id=${t}`;try{const t=await fetch(o);!function(t){console.log(t);const o=document.querySelector("#tabla-costos-cliente"),n=document.createElement("tbody"),a=t.reduce((function(e,t){return e+parseFloat(t.ingreso)}),0);e.textContent=a.toLocaleString("en"),t.forEach(e=>{const{id:t,ingreso:o,descripcion:a,reparacion_id:c}=e,r=document.createElement("tr"),i=document.createElement("td");i.classList.add("py-2"),i.style.minWidth="130px",i.innerHTML=`Valor: $<strong>${parseFloat(o).toLocaleString("en")}</strong>`;const s=document.createElement("td");s.classList.add("py-2"),s.innerHTML=`Descripcion: <strong style="max-width:30px !important">${a}</strong>`,r.appendChild(i),r.appendChild(s),n.appendChild(r)}),o.appendChild(n)}(await t.json())}catch(e){}}()}}(),function(){if(document.querySelector("#navReparacionCliente")){const e=document.querySelector("#general"),t=document.querySelector("#notificaciones"),o=document.querySelector("#avanzado"),n=document.querySelector("#info_general"),a=document.querySelector("#info_notificaciones"),c=document.querySelector("#info_avanzado");e.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),e.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),a.classList.add("d-none"),c.classList.add("d-none")}),t.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),t.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),n.classList.add("d-none"),c.classList.add("d-none")}),o.addEventListener("click",()=>{document.querySelector(".active-nav").classList.remove("active-nav"),o.classList.add("active-nav");document.querySelectorAll(".d-none").forEach(e=>{e.classList.remove("d-none")}),a.classList.add("d-none"),n.classList.add("d-none")})}}(),function(){if(document.querySelector("#tabla-notificaciones-cliente")){document.querySelector("#contenedorImganes");!async function(){const e=document.querySelector("#idReparacion").dataset.reparacionId,t=`${location.origin}/api/reparacion/notificaciones?id=${e}`;try{const e=await fetch(t);!function(e){const t=document.querySelector("#tabla-notificaciones-cliente");!function(e){for(;e.firstChild;)e.removeChild(e.firstChild)}(t);const o=document.createElement("tbody");let n=0;e.forEach(e=>{n++;const{id:t,mensaje:a,imagenes:c}=e,r=document.createElement("tr"),i=document.createElement("TD"),s=document.createElement("DIV");s.classList.add("row","d-flex","justify-content-between");const l=document.createElement("P");l.classList.add("col-md-8"),l.innerHTML="<strong>Mensaje:</strong><br>"+a;const d=document.createElement("DIV");d.id="carousel_"+n,d.classList.add("carousel","slide","float-right"),d.dataset.ride="carousel",d.style.maxWidth="350px",d.style.padding="10px";const u=document.createElement("OL");u.classList.add("carousel-indicators");const m=document.createElement("DIV");m.classList.add("carousel-inner");let p=1;c.forEach(e=>{if(""!=e){const t=document.createElement("LI");t.dataset.target="#carousel_"+n,t.dataset.slideTo=""+p;const o=document.createElement("DIV");o.classList.add("carousel-item");const a=document.createElement("IMG");a.classList.add("d-block","w-100"),a.src=`/img/notificaciones/${e}.png`,1==p&&(t.classList.add("active"),o.classList.add("active")),u.appendChild(t),o.appendChild(a),m.appendChild(o),p++}});const g=document.createElement("A");g.classList.add("carousel-control-prev"),g.href="#carousel_"+n,g.setAttribute("role","button"),g.dataset.slide="prev",g.innerHTML='\n                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>\n                            <span class="sr-only">Previous</span>\n                ';const f=document.createElement("A");f.classList.add("carousel-control-next"),f.href="#carousel_"+n,f.setAttribute("role","button"),f.dataset.slide="next",f.innerHTML=' \n                            <span class="carousel-control-next-icon" aria-hidden="true"></span>\n                            <span class="sr-only">Next</span>\n                ',d.appendChild(u),d.appendChild(m),d.appendChild(g),d.appendChild(f),s.appendChild(l),s.appendChild(d),i.appendChild(s),r.appendChild(i),o.appendChild(r)}),t.appendChild(o)}(await e.json())}catch(e){}}()}}();
//# sourceMappingURL=bundle.js.map
